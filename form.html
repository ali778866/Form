<!DOCTYPE html>
<html lang="en">
<head>
    <title>Document</title>
</head>
<body>
    <form onsubmit="saveToLocalStorage(event)">
        <label>Name</label>
        <input id='username' type="text" name="username" required />
        <label>Email</label>
        <input id='emailid' type="text" name="emailid" required />
        <label>Phone</label>
        <input id="phonenumber" type="tel" name="phonenumber" required />
        <button>Submit</button>
    </form>
    <ul id="listofUser"></ul>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
    <script>
        function saveToLocalStorage(event) {
            event.preventDefault();
            const name = event.target.username.value;
            const email = event.target.emailid.value;
            const phone = event.target.phonenumber.value;
            const user = {
                name,
                email,
                phone
            }
            axios.post("https://crudcrud.com/api/e79045b54480465f93a5865fe3e60c8f/appointment", user)
                .then((respone)=>{
                    console.log(respone)
                })
                .catch((error)=>{
                    console.log(error)
                })
            event.target.reset();
        }

        window.addEventListener("DOMContentLoaded", () => {
            axios.get("https://crudcrud.com/api/e79045b54480465f93a5865fe3e60c8f/appointment")
            .then((response)=>{
                console.log(response);

                for(var i=0;i<response.data.length; i++){
                    showUser(response.data[i]);
                }
            })
            .catch((error)=>{
                console.log(error);
            })
        })

        function showUser(user) {
            document.getElementById('emailid').value= '';
            document.getElementById('username').value= '';
            document.getElementById('phonenumber').value= '';
            if(localStorage.getItem(user.email) !=null){
                removeUserFromScreen(user.email)
            }

            const parentNode = document.getElementById('listofUser');
            const childHTML =`<li id=${user._id}> ${user.name} - ${user.email}
                                <button onclick=deleteUser('${user._id}')> Delete </button>
                                <button onclick=editUserDetails('${user.email}','${user.name}','${user.phone}','${user._id}')> Edit </button></li>`;
            
            parentNode.innerHTML = parentNode.innerHTML +childHTML;  
            }
            function editUserDetails(emailid, username, phonenumber, userId){
                document.getElementById('emailid').value=emailid;
                document.getElementById('username').value=username;
                document.getElementById('phonenumber').value=phonenumber;
                deleteUser(userId);
            }

            function deleteUser(userId){
                axios.delete(`https://crudcrud.com/api/e79045b54480465f93a5865fe3e60c8f/appointment/${userId}`)
                .then((response)=> {
                    removeUserFromScreen(userId)
                })
                .catch((err)=>{
                    console.log(err)
                })
            }

            function removeUserFromScreen(userId){
                const parentNode = document.getElementById('listOfUser');
                const childNodeToBeDeleted = document.getElementById(userId);
                if(childNodeToBeDeleted){
                    parentNode.removeChild(childNodeToBeDeleted)
                }
            }
    </script>
</body>
</html>